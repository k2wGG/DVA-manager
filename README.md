# Gata DVA Manager

**Gata DVA Manager** – скрипт для автоматизации работы с [DVA](https://app.gata.xyz/dataAgent) с использованием Playwright. Проект поддерживает запуск нескольких сессий (кошельков), опциональное использование прокси и включает механизм повторных попыток для нажатия кнопки «Start».

---

## План действий

### 1. Требования

- **Node.js** (рекомендуется версия 16+)
- **npm** (обычно устанавливается вместе с Node.js)
- (Опционально) **Git** для клонирования репозитория

---

## Инструкции для Windows

### Шаг 1. Клонирование репозитория и установка зависимостей

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/k2wGG/DVA-manager.git
   cd DVA-manager
   ```
2. Установите зависимости:
   ```bash
   npm install
   ```

### Шаг 2. Настройка конфигурации

#### Файл с настройками кошельков (configs.json)

Создайте в корне проекта файл `configs.json` со следующим содержимым:
```json
{
  "sessions": [
    {
      "address": "0xВашАдрес1",
      "bearer": "ВашEyТокен1",
      "llm_token": "ВашLLMToken1",
      "task_token": "ВашTaskToken1",
      "invite_code": "ВашInviteCode1"
    },
    {
      "address": "0xВашАдрес2",
      "bearer": "ВашEyТокен2",
      "llm_token": "ВашLLMToken2",
      "task_token": "ВашTaskToken2",
      "invite_code": "ВашInviteCode2"
    }
  ]
}
```

#### Файл с прокси (proxy.txt)

Если вы планируете использовать прокси, создайте файл `proxy.txt` в корневой директории, где каждая строка содержит прокси в одном из следующих форматов:

- **HTTP-прокси:**
  ```
  http://username:password@proxy.example.com:3128
  ```
- **SOCKS5-прокси:**
  ```
  socks5://proxy.example.com:1080
  ```

Если прокси не нужны, этот шаг можно пропустить.

### Шаг 3. Запуск проекта

1. Запустите проект:
   ```bash
   npm start
   ```
2. **Выбор ОС:**  
   На запрос введите `1` или `Windows`.

3. **Выбор конфигураций (кошельков):**  
   Будет выведен список сессий (кошельков) с их адресами. Введите номер нужной сессии или `all` для запуска всех.

4. **Использование прокси:**  
   После выбора сессий появится запрос:
   ```
   Нужен ли прокси? (Y/N):
   ```
   Введите `Y` (Yes) или `N` (No). Если выбран прокси, скрипт прочитает список из файла `proxy.txt` и распределит прокси по сессиям (по кругу).

5. Далее начинается автоматизация:
   - Скрипт устанавливает системные зависимости (с помощью `npx playwright install-deps` и `npx playwright install`).
   - Открывается браузер в headless-режиме, устанавливаются данные в localStorage.
   - Скрипт переходит на страницу DVA, пытается найти кнопку «Start» (с повторными попытками, если необходимо) и запускает имитацию активности.
   - Скриншоты сохраняются с уникальными именами (с меткой времени) для каждой сессии.

6. **Просмотр скриншотов:**  
   Скриншоты сохраняются в корне проекта с именами вида:
   ```
   current_screenshot_session1_<timestamp>.png
   current_screenshot_session2_<timestamp>.png
   ```
   Если встроенный просмотрщик не обновляет изображение автоматически, откройте их во внешнем просмотрщике.

7. **Остановка проекта:**  
   Для завершения работы нажмите `Ctrl + C` в терминале. Это корректно закроет все запущенные браузеры.

---

## Инструкции для Linux

### Шаг 1. Установка системных зависимостей

Для корректной работы Chromium в headless-режиме на Ubuntu (например, Ubuntu 24) необходимо установить ряд системных библиотек. Вы можете воспользоваться встроенной функцией установки зависимостей, которая выполняет команду с переменной окружения `DEBIAN_FRONTEND=noninteractive` для избежания интерактивных запросов. Эта команда выглядит так:
   
```bash
DEBIAN_FRONTEND=noninteractive sudo apt-get install -y xvfb libgbm-dev libxkbcommon-x11-0 libgtk-3-0 libx11-xcb1 libxcb1 libxss1 libnss3 libxcomposite1 libxcursor1 libxdamage1 libxi6 libxtst6 libatk1.0-0 libatk-bridge2.0-0 libpango-1.0-0 libpangocairo-1.0-0 libcups2 libdrm2 libxrandr2 libc6 ca-certificates fonts-liberation libappindicator3-1 libgbm1 libnspr4 libnss3 libxcb1 xdg-utils && npx playwright install-deps && npx playwright install
```

> **Замечание:**  
> Если какие-либо пакеты отсутствуют (например, libgconf-2-4 или libasound2), они могут быть удалены из команды, так как в Ubuntu 24 они могут быть устаревшими.

### Шаг 2. Клонирование репозитория и установка зависимостей

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/k2wGG/DVA-manager.git
   cd DVA-manager
   ```
2. Убедитесь, что у вас установлены Node.js и npm (можно установить через nvm).
3. Установите зависимости проекта:
   ```bash
   npm install
   ```

### Шаг 3. Настройка конфигурации

Следуйте тем же инструкциям, что и для Windows:

- Создайте `configs.json` с настройками кошельков.
- (Опционально) Создайте `proxy.txt` для прокси.

### Шаг 4. Запуск проекта

1. Запустите проект:
   ```bash
   npm start
   ```
2. **Выбор ОС:**  
   При запросе введите `2` или `linux`.

3. **Выбор сессий (кошельков):**  
   Введите номер нужной сессии или `all` для запуска всех.

4. **Использование прокси:**  
   Отвечайте `Y` или `N` на запрос о прокси. Если выбрано использование прокси, они будут распределены по сессиям.

5. Далее скрипт выполнит автоматизацию аналогично Windows.

### Дополнительно: Запуск в фоновом режиме через screen

Если вы хотите запустить проект в фоновом режиме:

1. Установите screen (если не установлен):
   ```bash
   sudo apt-get install screen
   ```
2. Запустите новую сессию:
   ```bash
   screen -S gata
   ```
3. Внутри сессии запустите:
   ```bash
   npm start
   ```
4. Для отсоединения нажмите `Ctrl + A`, затем `D`.
5. Для возврата в сессию:
   ```bash
   screen -r gata
   ```

---

## Возможные проблемы и рекомендации

- **Прокси:**  
  Если при использовании прокси возникают таймауты или ошибки подключения, проверьте их работоспособность вручную (например, через cURL) и убедитесь, что они корректно настроены для HTTPS.  
  Если ошибка сохраняется, попробуйте увеличить таймауты или сменить тип прокси.

- **Кэширование скриншотов:**  
  Если встроенный просмотрщик не показывает обновлённые изображения, проверьте файлы во внешнем просмотрщике или используйте уникальные имена файлов (с меткой времени).

- **Логи:**  
  В консоли выводятся подробные сообщения для каждого этапа работы. Если возникают ошибки, обратите внимание на сообщения и действуйте согласно рекомендациям.

---

## Завершение работы

Чтобы остановить автоматизацию, просто нажмите `Ctrl + C` в терминале. Это приведёт к корректному закрытию всех запущенных браузеров.

---

Эти инструкции помогут настроить и запустить **Gata DVA Manager** как в Windows, так и в Linux-среде. Перед загрузкой проекта на GitHub не забудьте добавить в `.gitignore` файлы с конфиденциальными данными (например, `configs.json`, `proxy.txt` и папку `node_modules`).
